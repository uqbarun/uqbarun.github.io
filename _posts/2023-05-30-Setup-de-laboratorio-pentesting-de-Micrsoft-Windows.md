---
title: Setup de laboratorio pentesting de Micrsoft Windows
description: Descripción de página
author: [UqbarUN]
date: 2023-05-30
layout: post
categories: [category]
tags: [tag1, tag2]
excerpt_separator: <!--more-->
---

# Setup de laboratorio pentesting de Micrsoft Windows
![](https://placehold.co/900x190)  

Vamos a configurar un laboratorio de pentesting para Windows, pero primero analizaremos cual es la versión de mas demanda, las principales vulnerabilidades y conceptos famosos para el pentesting de windows.

<!--more-->

***

- [Plantilla de blog](#plantilla-de-blog)
  * [Sección 1](#secci-n-1)
  * [Sección 2](#secci-n-2)
  * [Referencias](#referencias)

<!-- Generar tabla de contenidos con https://ecotrust-canada.github.io/markdown-toc/ -->

## Requisitos
* ISO de Microsoft Windows Evaluation 10 <https://www.microsoft.com/en-us/evalcenter/evaluate-windows-10-enterprise>
* qemu-kvm: Este es un emulador de código abierto que emula los recursos de hardware de una computadora.
* virt-manager: Una interfaz gráfica de usuario basada en Qt para crear y gestionar máquinas virtuales utilizando el demonio libvirt.
* virtinst: Una colección de utilidades de línea de comandos para crear y realizar cambios en máquinas virtuales.
* libvirt-clients: APIs y bibliotecas del lado del cliente para gestionar máquinas virtuales desde la línea de comandos.
* bridge-utils: Un conjunto de herramientas de línea de comandos para gestionar dispositivos de puente (bridge).
* libvirt-daemon-system: Proporciona archivos de configuración necesarios para ejecutar el servicio de virtualización.

## ¿Por qué estudiar las vulnerabilidades de Windows?

Bueno, pues representan 62.65%[^1] de la cuota de mercado de SO a nivel mundial

| ![Desktop Operating System Market Share Worldwide, Apr 2017 - Apr 2023](https://i.imgur.com/u0UkDFX.png) |
|:--:|
| *Desktop Operating System Market Share Worldwide, Apr 2017 - Apr 2023[^1].* |

## ¿Por cuál versión de windows debo empezar?
Como notamos en la gráfica de a continuación, en Colombia 🇨🇴 la cuota de mercado de **Windows 10 **para PC en Abril del 2023 es del **73.9%**[^2].

| ![Desktop Windows Version Market Share Colombia, Apr 2017 - Apr 2023](https://i.imgur.com/MnJmifg.png) |
|:--:|
| *Desktop Windows Version Market Share Colombia, Apr 2017 - Apr 2023[^2].* |

En abril de 2021, **Windows 10 20H2** (también conocida como actualización de octubre de 2020) alcanzó una participación de mercado del **40,1 %**, que es casi lo mismo que Windows 10 2004 (actualización de mayo de 2020). Windows 10 1909, que dejó de ser compatible con Microsoft en abril de 2021, perdió 7,3 puntos de cuota de mercado y ahora tiene un 11,1 %. Las versiones anteriores sin soporte permanecen relativamente sin cambios. El número de Windows Insiders aumentó del 0,5 % al 0,7 %.[^3]

Algunas diferencias[^4] principales entre Windows 10 Pro y Home son:

1.  Funcionalidad de dominio: Solo Pro puede unirse a un dominio de Active Directory.
2.  Políticas de grupo: Solo Pro tiene acceso completo a las Políticas de grupo.
3.  Escritorio remoto: Solo Pro permite el acceso remoto a la PC.
4.  BitLocker: Solo Pro incluye el cifrado de disco completo con BitLocker.
5.  Hyper-V: Solo Pro admite la virtualización con Hyper-V.
6.  Actualizaciones de Windows: Pro ofrece más control sobre las actualizaciones.

## ¿Virtualización Tipo 1 o Tipo 2?

Un hipervisor de Tipo 1 es un software de virtualización utilizado para crear máquinas virtuales sobre el hardware de la computadora. La instalación directa en el hardware permite que los hipervisores de Tipo 1 sean rápidos, eficientes y tengan una mejor seguridad en comparación con un hipervisor de Tipo 2[^5]. Los hipervisores de Tipo 1 imponen un aislamiento estricto entre las máquinas virtuales y son más adecuados para entornos de producción donde las máquinas virtuales podrían ser objeto de ataques[^6].

Por otro lado, un hipervisor de Tipo 2 es un software de virtualización instalado sobre el sistema operativo anfitrión que admite la virtualización. Dado que funciona sobre un sistema operativo, los hipervisores de Tipo 2 no son tan rápidos, eficientes ni seguros como los hipervisores de Tipo 1[^1].

> 📘 Info
> 
> Basándonos en esta información, parece que un hipervisor de Tipo 1 sería una mejor opción para virtualizar Windows con el fin de probar malware debido a su mejor seguridad y al estricto aislamiento entre las máquinas virtuales.

## ¿Puede un malware saltar del SO anfitrión al SO huésped?

## ¿Mi máquina soporta virtualización Tipo 1?
Necesitamos buscar si la CPU soporta tecnología de virtualización. Buscaremos que aparezca al menos una vez la cadena `vmx` par Intel VT-x o `svm` para AMD-V (svm):
```bash
$ egrep -c '(vmx|svm)' /proc/cpuinfo
8
```
Tambien verificaremos si [KVM](https://www.linux-kvm.org/page/Main_Page) es soportada con el siguiente comando:
```bash
$ kvm-ok
INFO: /dev/kvm exists
KVM acceleration can be used
```

## ¿Arquitectura de 32-bits o 64 bits?

X

## Recuros mínimos 

Processor: 	1 gigahertz (GHz) or faster compatible processor or System on a Chip (SoC)
RAM:  	1 gigabyte (GB) for 32-bit or 2 GB for 64-bit 
Hard drive size: 32GB or larger hard disk
https://www.microsoft.com/en-us/windows/windows-10-specifications

## ¿Qué tipo de disco duro virutal debo crear?

VirtualBox y QEMU utilizan formatos de disco duro virtual diferentes por defecto. Sin embargo, hay un formato de disco duro virtual comúnmente compatible con ambos: el formato **VHD (Virtual Hard Disk)**.

El formato VHD es un estándar de disco duro virtual desarrollado por Microsoft y es compatible con VirtualBox y QEMU. Esto significa que puedes crear un disco duro virtual en formato VHD y utilizarlo tanto en VirtualBox como en QEMU.

## Pasos finales
   
1.  Después de crear el disco duro virtual, selecciona la máquina virtual recién creada en VirtualBox y haz clic en "Configuración".
    
2.  En la configuración de la máquina virtual, ve a la pestaña "Almacenamiento". Haz clic en el ícono del CD/DVD y selecciona "Elegir un archivo de disco óptico virtual". Navega y selecciona la imagen ISO de Windows 10 Enterprise de 32 bits que descargaste anteriormente.
    
3.  Asegúrate de que la opción "Controlador: SATA" esté seleccionada para el archivo ISO de Windows 10 en la sección "Controlador: SATA Secundario Maestro".
    
4.  Ahora puedes iniciar la máquina virtual haciendo clic en "Iniciar" en la ventana principal de VirtualBox. La instalación de Windows 10 Enterprise de 32 bits debería comenzar y podrás seguir las instrucciones en pantalla para completar el proceso de instalación.   

Recuerda que estas instrucciones son generales y pueden variar según la versión específica de VirtualBox que estés utilizando. Asegúrate de consultar la documentación de VirtualBox y seguir las instrucciones correspondientes a tu versión particular del software para obtener una configuración precisa.

## Mas lectura

https://westoahu.hawaii.edu/cyber/vulnerability-research/vulnerability-tutorials/building-a-vulnerability-malware-test-lab/

https://www.sentinelone.com/labs/building-a-custom-malware-analysis-lab-environment/


## Referencias

[^1]: StatCounter Global Stats. (2023, May 30). Desktop Operating System Market Share Worldwide. Retrieved from <https://gs.statcounter.com/os-market-share/desktop/worldwide>

[^2]: StatCounter. (2023, May 30). Desktop Windows Version Market Share Colombia. Retrieved from <https://gs.statcounter.com/windows-version-market-share/desktop/colombia>

[^3]: Buria, A. T. (2021, abril 27). Windows 10 20H2 has just crossed the 40% market share. Winaero. <https://winaero.com/windows-10-20h2-has-just-crossed-the-40-market-share>

[^4]: Compare windows 10 home y pro \| microsoft windows. (s. f.). Windows. Recuperado 30 de mayo de 2023, de <https://www.microsoft.com/es-es/windows/compare-windows-10-home-vs-pro>
 
[^5]: Maning, J. (2023, enero 9). Hypervisor type 1 vs. Type 2: What is the difference, and does it matter? MUO. <https://www.makeuseof.com/type-1-vs-type-2-hypervisor-what-is-the-difference>

[^6]: Virtual security tactics for Type 1 and Type 2 hypervisors \| TechTarget. (s. f.). IT Operations. Recuperado 30 de mayo de 2023, de <https://www.techtarget.com/searchitoperations/answer/Virtual-security-tactics-for-Type-1-and-Type-2-hypervisors>

